<!DOCTYPE html>
<html>
<head>
    <title>Committee Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
    <h1>Committee Dashboard</h1>

    <h2>Committees</h2>
    <ul>
        {% for committee in committees %}
            <li>{{ committee.name }}
                {% if committee.parent %}
                    (Child of {{ committee.parent.name }})
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <h2>Experts</h2>
    <ul>
        {% for expert in experts %}
            <li>{{ expert.name }} - {{ expert.email }}</li>
        {% endfor %}
    </ul>

    <h2>Memberships</h2>
    <ul>
        {% for membership in memberships %}
            <li>
                {{ membership.expert.name }} → {{ membership.committee.name }}
            </li>
        {% endfor %}
    </ul>

    <h2>Meetings</h2>
<ul>
    {% for meeting in meetings %}
        <li>
            <strong>{{ meeting.committee.name }}</strong> on {{ meeting.date }}  
            <br>Agenda: {{ meeting.agenda }}

            <h5 class="mt-2">Participation</h5>
            <form method="POST" action="{{ url_for('add_participation', meeting_id=meeting.id) }}">
                <div class="mb-2">
                    <label>Expert</label>
                    <select name="expert_id" class="form-select" required>
                        {% for expert in experts %}
                            <option value="{{ expert.id }}">{{ expert.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-check">
                    <input type="checkbox" name="attendance" class="form-check-input" id="attend{{ meeting.id }}">
                    <label class="form-check-label" for="attend{{ meeting.id }}">Attended</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" name="report_submitted" class="form-check-input" id="report{{ meeting.id }}">
                    <label class="form-check-label" for="report{{ meeting.id }}">Report Submitted</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" name="reminder_sent" class="form-check-input" id="reminder{{ meeting.id }}">
                    <label class="form-check-label" for="reminder{{ meeting.id }}">Reminder Sent</label>
                </div>
                <button type="submit" class="btn btn-sm btn-primary mt-2">Save Participation</button>
            </form>

            <ul class="mt-2">
    {% for p in participations if p.meeting_id == meeting.id %}
        <li>
            {{ p.expert.name }} → 
            {% if p.attendance %}✔ Attended{% else %}✘ Absent{% endif %}, 
            {% if p.report_submitted %}✔ Report{% else %}✘ No Report{% endif %}, 
            {% if p.reminder_sent %}✔ Reminder{% else %}✘ No Reminder{% endif %}

            <!-- Edit form -->
            <form method="POST" action="{{ url_for('update_participation', participation_id=p.id) }}" class="mt-1">
                <div class="form-check">
                    <input type="checkbox" name="attendance" class="form-check-input" id="attend{{ p.id }}" {% if p.attendance %}checked{% endif %}>
                    <label class="form-check-label" for="attend{{ p.id }}">Attended</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" name="report_submitted" class="form-check-input" id="report{{ p.id }}" {% if p.report_submitted %}checked{% endif %}>
                    <label class="form-check-label" for="report{{ p.id }}">Report Submitted</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" name="reminder_sent" class="form-check-input" id="reminder{{ p.id }}" {% if p.reminder_sent %}checked{% endif %}>
                    <label class="form-check-label" for="reminder{{ p.id }}">Reminder Sent</label>
                </div>
                <button type="submit" class="btn btn-sm btn-secondary mt-1">Update</button>
            </form>
        </li>
    {% endfor %}
</ul>
        </li>
    {% endfor %}
</ul>
</body>
</html>